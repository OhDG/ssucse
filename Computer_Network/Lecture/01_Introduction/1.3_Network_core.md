# 1.3 : 네트워크 코어

## 1.3.1 : 패킷 교환

---

-   출발지 종단 시스템에서 목적지 종단 시스템으로 메세지를 보내기 위해 송신 시스템은 긴 메세지를 패킷(packet)이라고 하는 작은 데이터 덩어리로 분할
    -   송신 측과 수신 측 사이에서 각 패킷
        -   통신 링크와 패킷 스위치(packet switch)를 거침
        -   라우터(router)와 링크 계층 스위치(link-layer switch)를 거칠수도
        -   패킷은 링크의 최대 전송률과 같은 속도로 각각의 통신 링크에서 전송됨

### 저장-후-전달

---

-   대부분의 패킷 스위치
    -   저장-후-전달 전송(store-and-forward transmission) 방식을 이용
        -   스위치가 출력 링크로 패킷의 첫 비트를 전송하기 전에 전체 패킷을 받아야 함
-   라우터는 보통 여러 개의 링크를 가짐
    -   라우터의 기능이 입력되는 패킷을 출력 링크로 교환하는 것이기 때문
-   라우터가 저장-후-전달을 채택
    -   패킷의 비트를 먼저 저장(buffer, 즉 ‘store’)한 후, 라우터가 패킷의 모든 비트를 수신한 후에만 출력 링크로 그 패킷을 전송(transmit, 즉 ‘forward’)하기 시작

### 큐잉 지연과 패킷 손실

---

-   각 패킷 스위치는 접속된 여러 개의 링크를 가짐
    -   각 링크에 대해 패킷 스위치는 출력 버퍼(output buffer, 출력 큐(output queue))를 가짐
        -   그 링크로 송신하려고 하는 패킷을 저장하고 있음
        -   도착하는 패킷이 한 링크로 전송되어야 하는데 그 링크가 다른 패킷을 전송하고 있다면
            -   도착하는 패킷은 출력 버퍼에서 대기
                -   이게 큐잉 지연(queuing delay)
-   저장-후-전달 지연뿐만 아니라
    -   패킷은 출력 버퍼에서 큐잉 지연을 겪음
        -   이들 지연은 가변적, 네트워크의 혼잡 정도에 따름
-   버퍼 공간의 크기가 유한
    -   도착하는 패킷은 버퍼가 전송을 위해 대기 중인 다른 패킷들로 꽉 차 있는 경우
        -   패킷 손실(packet loss)이 발생
            -   도착하는 패킷 혹은 이미 큐에 대기 중인 패킷을 폐기(drop)함

### 포워딩 테이블과 라우팅 프로토콜

---

-   인터넷에서 모든 종단 시스템은 IP 주소를 가짐
-   출발지 종단 시스템이 패킷을 목적지 종단 시스템으로 보내고자 할 때
    -   출발지는 패킷의 헤더에 목적지의 IP 주소를 포함
        -   IP 주소는 계층적 구조를 가짐
-   패킷이 네트워크의 한 라우터에 도착하면
    -   라우터는 패킷의 목적지 주소의 일부를 조사하고 그 패킷을 이웃 라우터로 전달함
        -   각 라우터는 목적지 주소(혹은 목적지 주소의 일부)를 라우터의 출력 링크로 매핑하는 포워딩 테이블(forwarding table)을 가짐
            -   패킷이 라우터에 도착하면 라우터는 올바른 출력 링크를 찾기 위해 주소를 조사하고 이 목적지 주소를 이용하여 포워딩 테이블을 검색
            -   그런 후에 라우터는 그 패킷을 출력 링크로 보냄
-   포워딩 테이블은 어떻게 설정?
    -   인터넷은 자동으로 포워딩 테이블을 설정하는데 이용되는 여러 특별한 라우팅 프로토콜(routing protocol)을 갖고 있음
        -   라우팅 프로토콜은 각 라우터로부터 각 목적지까지의 최단 경로를 결정
        -   라우터에 포워딩 테이블을 설정하는 데 이 최단 경로 결과를 이용

## 1.3.2 : 회선 교환

---

-   링크와 스위치의 네트워크를 통해 데이터를 이동시키는 방식
    -   회선 교환(circuit switching)
    -   패킷 교환(packet switching)
-   회선 교환 네트워크에서 종단 시스템 간의 통신을 제공하기 위해
    -   경로상에 필요한 자원(버퍼, 링크 전송률)은 통신 세션(session) 동안에 확보 또는 예약(reserve)됨
-   세션 메세지는 온디맨드(on-demand) 방식으로 자원을 요청하여 사용
    -   그 결과, 통신 링크에 대한 접속을 위해 기다릴(즉, 큐에서 대기) 수도 있음
-   회선 교환 네트워크의 예로 전통적인 전화망이 있음
    -   송신자가 정보를 보내기 전에 네트워크는 송신자와 수신자 간의 연결을 설정해야 함
        -   송신자와 수신자 간의 경로에 있는 스위치들이 해당 연결 상태를 유지해야 하는 연결
            -   이 연결을 회선(circuit)이라고 함
-   네트워크가 회선을 설정할 때
    -   그 연결이 이루어지는 동안 네트워크 링크(각 링크의 전송 용량의 일부를 나타냄)에 일정한 전송률을 예약
        -   송신자는 수신자에게 보장된(guaranteed) 일정 전송률로 데이터를 보낼 수 있음
-   두 호스트가 통신하고 싶을 때
    -   네트워크는 두 호스트 사이에 지정된 종단 간 연결(end-to-end connection)을 설정
        -   호스트 A가 호스트 B와 통신하기 위해 네트워크는 먼저 2개의 링크 각각에 한 회선을 예약함
            -   링크는 4개의 회선을 가지므로 종단 간 연결을 사용하는 각 링크에 대해 그 연결은 연결이 지속되는 동안 링크 전체 전송 용량의 1/4를 얻음
-   반대로, 한 호스트가 인터넷 같은 패킷 교환 네트워크를 통해 다른 호스트로 패킷을 보내고자 할 때
    -   링크 자원을 예약하지 않고 네트워크로 보내짐
    -   만약 그 시간에 링크로 다른 패킷들이 전송되어야 해서 링크 중 하나가 혼잡하다면
        -   그 패킷은 전송 링크의 송신 쪽 버퍼에서 기다려야 하고 지연이 발생함

### 회선 교환 네트워크에서의 다중화

---

-   링크 내 한 회선은
    -   주파수 분할 다중화(frequency-division multiplexing, FDM)
    -   혹은 시분할 다중화(time-division multiplexing, TDM)로 구현됨
-   FDM에서 링크를 통해 설정된 연결
    -   그 링크의 주파수 스펙트럼을 공유함
    -   그 링크는 연결되는 동안 각 연결에 대해 주파수 대역을 고정 제공함
    -   전화망에서의 이 주파수 대역은 일반적으로 4 kHZ 폭을 가짐
        -   이런 대역의 폭을 대역폭(bandwidth)이라고 함
-   TDM 링크의 경우는 시간을 일정 주기의 프레임으로 구분하고 각 프레임을 고정된 수의 시간 슬롯으로 나눔
    -   네트워크는 모든 프레임에서 시간 슬롯 1개를 그 연결에 할당함
    -   이들 슬롯은 그 연결을 위해 사용되도록 할당됨
    -   그 연결의 데이터를 전송하기 위해 모든 프레임에 하나의 시간 슬롯을 갖게 됨
-   패킷 교환 옹호론자
    -   회선 교환의 경우에 할당된 회선이 비활용 기간(silent period)에는 놀게 되므로 낭비
-   회선 교환 네트워크를 통해 호스트 A에서 호스트 B까지 640,000 비트의 파일을 보내는 데 걸리는 시간
    -   네트워크의 모든 링크는 24개의 슬롯을 가진 TDM을 사용
    -   1,536 Mbps 전송률이 가능
    -   호스트 A가 파일을 전송하기 전에 종단 간 회선을 설정하는 데 0.5초가 걸림
        -   각 회선의 전송률은 (1,536 Mbps)/24 = 64 kbps
        -   파일을 전송하는 데
            -   (640,000)/(64 kpbs) = 10초
        -   여기에 회선 설정 시간을 더하면 총 10.5초
-   전송(transmission) 시간은 링크 수와 무관함

### 패킷 교환 대 회선 교환

---

-   패킷 교환 반대
    -   가변적이고 예측할 수 없는 종단 간의 지연(주로 불규칙적이고 예측할 수 없는 큐잉 지연에서 발생) 때문에 패킷 교환이 실시간 서비스(예: 전화 통화와 화상 통화)에는 적당하지 않음
-   패킷 교환 옹호
    -   패킷 교환이 회선 교환보다 전송 용량의 공유에서 더 효율적
    -   패킷 교환이 더 간단하고 효율적이며 회선 교환보다 구현 비용이 적음
-   패킷 교환은 거의 항상 회선 교환과 대등한 지연 성능을 가지면서도 거의 3배 이상의 사용자 수를 허용함
-   패킷 교환에 경우에는 패킷을 생성하는 다른 사용자가 없기에 다중화가 요구되지 않고 사용자는 링크가 가득 찰 때까지 패킷을 계속 보낼 수 있음
-   링크 전송률을 공유하는 두 방식의 가장 큰 차이점
    -   회선 교환이 요구에 관계없이 미리 전송 링크의 사용을 할당하는 반면에
    -   패킷 교환은 요구할 때만 링크의 사용을 할당함
        -   패킷 교환 방식에서 링크 전송 능력은 링크에 전송할 패킷을 가진 사용자만이 패킷 기반으로 공유함

## 1.3.3 : 네트워크의 네트워크

---

-   종단 시스템(PC, 스마트폰, 웹 서버, 메일 서버 등)이 접속 ISP를 통해 인터넷에 연결됨
-   접속 ISP는 DSL, 케이블, FTTH, 와이파이, 셀룰러(이동 통신)를 포함하는 다양한 접속 기술을 이용하여 유선 혹은 무선 연결을 제공
-   종단 사용자들과 콘텐츠 제공자들을 접속 ISP로 연결하는 것은 인터넷을 구성하는 수십억 개의 종단 시스템을 연결하는 퍼즐의 해결 방법 중 극히 일부분
    -   접속 ISP들이 서로 연결되어야 함
        -   이를 위해 네트워크의 네트워크(network of network)가 탄생
-   모든 종단 시스템이 서로에게 패킷을 보낼 수 있도록 접속 ISP를 연결하는 것
    -   네트워크 구조 1은 모든 접속 ISP를 하나의 글로벌 통과(transit) ISP와 연결함
    -   네트워크 구조 2는 수십만 개의 접속 ISP와 다중의 글로벌 ISP로 구성됨
        -   상위층에 글로벌 통과 서비스 제공자가 있고 하위층에 접속 ISP가 있는 형태의 2계층구조
    -   네트워크 구조 3은 도시, 지방, 국가 계층같은 다중계층구조
        -   오늘날의 인터넷과 대략적으로 유사
    -   네트워크 구조 4는 접속 ISP, 지역 ISP, 1계층 ISP, PoP, 멀티홈, 피어링, IXP로 구성됨
    -   네트워크 구조 5는 네트워크 구조 4 위에 콘텐츠 제공자 네트워크(content-provider network)를 추가함
-   오늘날의 인터넷(네트워크의 네트워크)은 복잡함
    -   12개 정도의 1계층 ISP들과 수십만 개의 하위 계층 ISP로 구성되어 있음
