# 1.4 : 패킷 교환 네트워크에서의 지연, 손실과 처리율

---

-   컴퓨터 네트워크
    -   반드시 두 종단 시스템 간에 처리율(전달될 수 있는 초당 데이터의 양)을 제한
        -   종단 시스템 간에 지연을 야기
        -   실제로 패킷을 잃어버리기도 함

## 1.4.1 : 패킷 교환 네트워크에서의 지연 개요

---

-   패킷이 경로를 따라 한 노드(호스트 혹은 라우터)에서 다음 노드(호스트 혹은 라우터)로 전달
    -   그 패킷은 경로상의 각 노드에서 다양한 지연을 겪게 됨
-   전체 노드 지연(total nodal delay)
    -   노드 처리 지연(nodal processing delay)
    -   큐잉 지연(queuing delay)
    -   전송 지연(transmission delay)
    -   전파 지연(propagation delay)
-   인터넷 애플리케이션(검색, 웹 브라우징, 전자메일, 지도, 인스턴트 메세징, VoIP(Voice-over-IP) 등)의 성능
    -   네트워크의 지연에 상당한 영향을 받음

### 지연 유형

---

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/80651bdc-a740-4857-9255-39299a6f9b10/d4a2b22f-957a-478d-9c4b-4964f4c8cc75/image.png)

-   출발지와 목적지 사이 종단 간 경로의 일부로서 한 패킷이 업스트림 노드로부터 라우터 A를 통해 라우터 B로 보내짐
    -   A에서의 노드 지연 특성
        -   라우터 A가 라우터 B에 이르는 하나의 출력(outgoing) 링크를 가짐
            -   이 링크 앞에 큐(queue, 버퍼(buffer))가 있음
        -   패킷이 업스트림 노드로부터 라우터 A에 도착하면
            -   라우터 A는 그 패킷에 대한 적당한 출력 링크를 결정하기 위해 패킷 헤더를 조사하고 선택된 링크로 그 패킷을 보냄
            -   패킷은 링크에 현재 전송되는 다른 패킷이 없고 큐에 자신보다 앞선 다른 패킷이 없으면 링크로 전송될 수 있음
            -   링크가 이미 이용되고 있거나 그 링크를 이용하기 위해 큐에서 대기하는 패킷이 있다면 큐에 들어감

### 처리 지연

---

-   처리 지연(processing delay)
    -   패킷 헤더를 조사하고 그 패킷을 어디로 보낼지를 결정하는 시간
    -   업스트림 노드에서 라우터 A로 패킷의 비트를 전송하면서 발생하는 패킷의 비트 레벨 오류를 조사하는 데 필요한 시간과 같은 요소를 포함
-   고속 라우터에서의 처리 지연
    -   일반적으로 수 마이크로초
-   이 노드 처리 후에 라우터
    -   그 패킷을 라우터 B에 이르는 링크에 앞선 큐에 보냄

### 큐잉 지연

---

-   큐잉 지연(queuing delay)
    -   패킷은 큐에서 링크로 전송되기를 기다림
-   특정 패킷의 큐잉 지연 길이
    -   큐에 저장되어 링크로 전송되기를 기다리는 다른(앞서 도착한) 패킷의 수에 의해 결정됨
-   주어진 패킷의 지연
    -   패킷마다 상당히 다름
-   도착하는 패킷이 발견하는 이미 도착한 패킷의 수
    -   큐에 도착하는 트래픽의 강도와 특성에 따름
-   현실에서 큐잉 지연
    -   수 마이크로초에서 수 밀리초

### 전송 지연

---

-   패킷이 선입선출 방식으로 전송
    -   인터넷에서 패킷은 앞서 도착한 다른 모든 패킷이 전송된 다음에 전송됨
-   패킷의 길이를 L비트
-   라우터 A에서 라우터 B까지 링크의 전송률은 R bps
    -   R은 라우터 B로 가는 링크의 전송률에 의해 결정됨
-   전송 지연(transmission delay)
    -   L/R
    -   패킷의 모든 비트를 링크로 밀어내는 데(또는 전송하는 데) 필요한 시간
-   전송지연은 일반적으로
    -   수 마이크로초에서 수 밀리초

### 전파 지연

---

-   전파 지연(propagation delay)
    -   링크의 처음부터 라우터 B까지의 전파에 필요한 시간
    -   두 라우터 사이의 거리를 전파 속도로 나눈 것
    -   d/s (d는 라우터 A와 B 사이의 거리, s는 링크의 전파 속도)
-   비트는 링크의 전파 속도로 전파됨
    -   전파 속도는 링크의 물리 매체(광섬유, 꼬임쌍선 등)에 따라 다름
    -   2 X 10^8미터/초 ~ 3 X 10^8미터/초
    -   빛의 속도와 같거나 약간 작음
-   일단 패킷의 마지막 비트가 B 노드에 전파되면
    -   이 비트와 앞선 모든 비트는 라우터 B에 저장됨
        -   이러한 과정이 다음 노드로 전달되기 위해 반복됨
-   광역 네트워크에서 전파 지연
    -   수 밀리초

### 전송 지연과 전파 지연 비교

---

-   전송 지연
    -   라우터가 패킷을 내보내는 데 필요한 시간
    -   패킷 길이와 링크 전송률의 함수
    -   두 라우터 사이의 거리는 관계없음
-   전파 지연
    -   비트가 한 라우터에서 다음 라우터로 전파되는 데 걸리는 시간
    -   두 라우터 사이의 거리에 대한 함수
    -   패킷 길이나 링크 전송률과는 관계없음
-   패킷의 앞선 비트들이 패킷의 나머지 다른 비트가 이전 라우터에서 전송되기를 기다리는 동안 이미 다음 라우터에 도착할 수 있음
-   전체 노드 지연 = 처리 지연 + 큐잉 지연 + 전송 지연 + 전파 지연
    -   이런 지연 요소의 기여도에는 종류마다 상당한 차이를 가짐

## 1.4.2 : 큐잉 지연과 패킷 손실

---

-   처리 지연, 전송 지연, 전파 지연과는 다르게
    -   큐잉 지연은 패킷마다 다를 수 있음
-   언제 큐잉 지연이 크고, 언제 미미한가?
    -   트래픽이 큐에 도착하는 비율
    -   링크의 전송률
    -   도착하는 트래픽의 특성, 즉 트래픽이 주기에 맞춰서 또는 버스트(burst)하게 도착하느냐
-   a는 패킷이 큐에 도착하는 평균율(패킷/초)
-   R은 전송률, 즉 비트가 큐에서 밀려나는 비율(비트/초)
-   모든 패킷이 L비트
-   비트가 큐에 도착하는 평균율은 La비트/초
-   큐가 매우 커서 무한대 비트를 저장할 수 있음
-   트래픽 강도(traffic intensity), 즉 La/R
    -   La/R > 1이면
        -   비트가 큐에 도착하는 평균율이 비트가 큐에서 전송되는 비율을 초과함
        -   큐는 끝없이 증가
        -   큐잉 지연은 무한대에 도달
        -   트래픽 강도가 1보다 크지 않게 시스템을 설계해야됨
    -   La/R ≤ 1이면
        -   도착 트래픽의 특성이 큐잉 지연에 영향을 미침
            -   패킷이 주기적으로 도착 → 모든 패킷은 빈 큐에 도착, 큐잉 지연은 없음
            -   패킷이 몰려서(버스트) 도착 → 상당한 평균 큐잉 지연이 생길 것임
            -   N개의 패킷이 동싱에 (L/R)N초마다 도착
                -   n번째 전송된 패킷은 (n - 1)L/R초의 큐잉 지연을 겪음
-   일반적으로 큐에 도착하는 프로세스는 랜덤(random)
-   트래픽 강도가 0에 가까우면
    -   패킷 도착이 드물고 간격이 멀어서 다음에 도착하는 패킷이 큐에서 다른 패킷을 발견하는 경우가 없을 것임
    -   평균 큐잉 지연은 0에 가까워짐
-   트래픽 강도가 1에 가까우면
    -   패킷 도착이 전송용량을 초과하여(패킷 도착률의 가변성으로 인해) 큐가 생성될 것임
    -   도착률이 전송률보다 작아질 때, 큐의 길이는 줄어들 것임
    -   트래픽 강도가 1에 접근할수록 평균 큐 길이는 점점 증가
    -   트래픽 강도가 1에 접근할수록 평균 큐잉 지연이 급속히 증가함

### 패킷 손실

---

-   큐 용량이 유한
    -   트래픽 강도가 1에 접근함에 따라 패킷이 도착해서 큐가 꽉 찬 것을 발견
    -   패킷을 저장할 수 없는 경우에 라우터는 그 패킷을 버림(drop)
    -   그 패킷을 잃어버리게 됨(lost)
    -   큐에서의 오버플로(overflow)
-   손실 패킷의 비율은 트래픽 강도가 클수록 증가
    -   노드에서의 성능은 지연뿐만 아니라 패킷 손실 확률로도 측정함

## 1.4.3 종단 간 지연

---

-   출발지에서 목적지까지의 지연
    -   출발지 호스트와 목적지 호스트 사이에 N - 1개의 라우터가 있음
    -   네트워크가 혼잡하지 않음(큐잉 지연 무시)
    -   각 라우터와 출발지 호스트의 처리 지연은 d_proc
    -   각 호스트와 출발지 호스트에서의 전송률은 R비트/초
    -   각 링크에서의 전파 지연은 d_prop
    -   d_trans = L/R, L은 패킷 크기
        -   d_end-end = N (d_proc + d_trans + d_prop)

### Traceroute

---

-   사용자가 목적지 호스트 이름을 제시하면
    -   출발지 호스트에 있는 프로그램은 목적지를 향해 여러 개의 특별한 패킷을 보냄
    -   이 패킷들은 목적지로 전진하면서 여러 개의 라우터를 통과함
    -   한 라우터가 이 특별한 패킷 중 하나를 받으면 출발지로 짧은 메세지를 보냄
    -   이 메세지에는 그 라우터의 이름과 주소가 포함됨
-   출발지와 목적지 사이에 N - 1개의 라우터가 있음
    -   출발지가 네트워크로 N개의 특별 패킷을 보냄
        -   각각은 최종 목적지의 주소를 갖고 있음
    -   n번째 라우터가 n으로 표시된 n번째 패킷을 받으면 라우터는 그 패킷을 목적지까지 전달하지 않는 대신 출발지에 역으로 메세지를 보냄
    -   목적지 호스트가 N번째 패킷을 받으면 그 목적지 노드는 그 패킷을 파기하고 출발지로 메세지를 보냄
    -   출발지는 한 패킷을 보내고 그에 해당하는 응답 메세지를 받을 때까지 경과 시간을 기록함
        -   메세지를 보내온 라우터(혹은 목적지 호스트) 이름과 주소도 기록함
-   출발지가 자신에서부터 목적지까지 패킷이 흘러간 경로를 재구성할 수 있음
-   출발지는 모든 중간에 있는 라우터까지의 왕복 지연을 결정할 수 있음
-   Traceroute는 위 과정을 세 번 반복함
    -   출발지는 3 X N 패킷을 목적지로 보냄
-   결과물에는 6개의 항목
    1. 경로상의 라우터 번호
    2. 라우터의 이름
    3. 라우터 주소
    4. 세 번 실험의 왕복 지연 시간
        1. 출발지가 네트워크에서 패킷 손실로 인해 어떤 주어진 라우터로부터 3개보다 적은 메세지를 받으면 라우터 번호 뒤에 별표로 표시함
        2. 왕복 지연은 전송 지연, 전파 지연, 라우터 처리 지연, 큐잉 지연 등을 포함
-   왕복 지연이 크게 증가했음
    -   라우터 사이에 상대적으로 긴 전파 지연이 생기는 대륙 간 광케이블이 있기 때문임

### 종단 시스템, 애플리케이션 그리고 그 밖의 지연

---

-   공유 매체(와이파이 혹은 케이블 모뎀)로 패킷을 전송하고자 하는 종단 시스템
    -   다른 종단 시스템과 매체를 공유하기 위해 프로토콜의 일부로 전송을 의도적으로 지연할 수 있음
-   VoIP(Voice-over-IP) 애플리케이션에 있는 미디어 패킷화 지연(media packetization delay)
    -   VoIP에서 송신 측은 먼저 패킷을 인터넷으로 보내기 전에 패킷을 인코딩된 디지털 음성으로 채워야 함
    -   이 패킷을 채우는 시간(패킷화 지연)
    -   VoIP 콜(call)의 사용자가 느끼는 품질에 영향을 줄 수 있음

## 1.4.4 : 컴퓨터 네트워크에서의 처리율

-   종단 간 처리율(throughput)
    -   컴퓨터 네트워크에서의 주요한 성능 수단
-   컴퓨터 네트워크를 통해 호스트 A에서 호스트 B로 커다란 파일을 전송하는 것
    -   어느 한 순간에서의 순간적인 처리율(instantaneous throughput)
        -   호스트 B가 파일을 수신하는 비율(비트/초)
    -   파일이 F비트로 구성됨
    -   호스트 B가 모든 F비트를 수신하는 데 T초가 걸림
    -   파일 전송의 평균 처리율(average throughput)은 F/T비트/초
        -   가능한 한 높은 처리율을 갖는 것이 바람직함
-   2개의 통신 링크와 라우터로 연결된 하나의 서버와 하나의 클라이언트
    -   R_s는 서버와 라우터 간의 링크 속도
    -   R_c는 라우터와 클라이언트 간의 링크 속도
    -   서버-클라이언트 처리율
        -   min{R_s, R_c}, 즉 병목 링크(bottleneck link)의 전송률
    -   F비트의 커다란 파일을 서버에서 클라이언트로 전송하는 데 걸리는 시간으로 F/min{R_s, R_c}
-   서버와 클라이언트 간에 N개의 링크를 가진 네트워크
    -   처리율이 min{R_1, R_2, …, R_N}
    -   서버와 클라이언트 간 경로상에서의 병목 링크의 전송률
-   컴퓨터 네트워크로 연결된 2개의 종단 시스템, 즉 서버와 클라이언트
    -   출발지에서 목적지로 흐를 수 있는 비트 속도
        -   처리율 = min{R_s, R_c}
-   컴퓨터 네트워크의 코어에 연결된 10개의 서버와 10개의 클라이언트
    -   10개의 다운로드가 통과하는 코어에 하나의 링크가 있음
        -   이 링크의 전송률이 R
    -   공통 링크 R의 속도가 R_s, R_c보다 크다면
        -   처리율은 min{R_s, R_c}
    -   공롱 링크 R의 속도가 R_s, R_c와 같은 수준이라면
        -   공통 링크는 10개의 다운로드에 똑같이 전송률을 나눔
        -   코어에서의 공유 링크가 병목이 됨
        -   처리율은 경로 링크의 전송률에 의존할 뿐만 아니라 간섭 트래픽에도 의존함
